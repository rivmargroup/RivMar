
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>RivMar - Servicios Marinos</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
    header {
      background-color: #003366; color: white;
      padding: 15px 30px; display: flex; justify-content: space-between; align-items: center;
    }
    header h1 { margin: 0; font-size: 20px; }
    .btn-login {
      background: white; color: #003366; border: none; padding: 10px 20px;
      font-weight: bold; cursor: pointer; border-radius: 4px;
    }
    .auth-popup {
      display: none; position: absolute; top: 60px; right: 20px;
      background: white; padding: 20px; border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 100;
    }
    .auth-popup input, .auth-popup button {
      display: block; margin: 10px auto; padding: 10px; width: 90%;
    }
    .section {
      text-align: center; padding: 100px 20px;
    }
    #user-content {
      display: none; max-width: 500px; margin: 40px auto;
      background: white; padding: 30px; border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    #user-content h2 { margin-top: 0; }
    input[type="file"] { margin-top: 10px; }
    a { color: #0074D9; font-weight: bold; }
  </style>
</head>
<body>

<header>
  <h1>RivMar Servicios Marinos</h1>
  <button class="btn-login" onclick="toggleAuth()">Login</button>
</header>

<div class="auth-popup" id="auth-popup">
  <input type="email" id="email" placeholder="Correo electrónico" />
  <input type="password" id="password" placeholder="Contraseña" />
  <button onclick="login()">Iniciar sesión</button>
  <button onclick="register()">Registrarse</button>
</div>

<div class="section">
  <h2>Bienvenido a RivMar</h2>
  <p>Ofrecemos limpieza profesional de cascos de botes con tecnología avanzada.</p>
</div>

<div id="user-content">
  <h2>Mi Perfil</h2>
  <form onsubmit="saveProfile(event)">
    <input type="text" id="nombre" placeholder="Nombre" required><br>
    <input type="text" id="apellido" placeholder="Apellido"><br>
    <input type="tel" id="telefono" placeholder="Teléfono de contacto"><br>
    <input type="email" id="emailProfile" placeholder="Correo electrónico" disabled><br>
    <label>Foto de perfil (opcional):</label>
    <input type="file" id="fotoPerfil"><br><br>
    <button type="submit">Guardar Perfil</button>
  </form>
  <br>
  <p id="drive-link">Tu enlace de limpieza aparecerá aquí.</p>
  <br>
  <button onclick="logout()">Cerrar sesión</button>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyALCBhybMXTS_SPzC013YEkWBwvPv-_QZY",
    authDomain: "rivmar-clientes.firebaseapp.com",
    projectId: "rivmar-clientes",
    storageBucket: "rivmar-clientes.appspot.com",
    messagingSenderId: "631400927733",
    appId: "1:631400927733:web:aab935d3fafb07e07490bc",
    measurementId: "G-3FNQ0BHT31"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  function toggleAuth() {
    const popup = document.getElementById("auth-popup");
    popup.style.display = popup.style.display === "block" ? "none" : "block";
  }

  function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, password)
      .then((userCredential) => loadUserData(userCredential.user))
      .catch((error) => alert(error.message));
  }

  function register() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    auth.createUserWithEmailAndPassword(email, password)
      .then((userCredential) => {
        db.collection("users").doc(userCredential.user.uid).set({
          email: email,
          driveLink: "",
          nombre: "",
          apellido: "",
          telefono: ""
        });
        loadUserData(userCredential.user);
      })
      .catch((error) => alert(error.message));
  }

  function logout() {
    auth.signOut().then(() => {
      document.getElementById("user-content").style.display = "none";
    });
  }

  function loadUserData(user) {
    db.collection("users").doc(user.uid).get().then(doc => {
      const data = doc.data();
      document.getElementById("nombre").value = data.nombre || "";
      document.getElementById("apellido").value = data.apellido || "";
      document.getElementById("telefono").value = data.telefono || "";
      document.getElementById("emailProfile").value = data.email || "";
      document.getElementById("drive-link").innerHTML = data.driveLink
        ? `<a href="${data.driveLink}" target="_blank">Ver limpieza</a>`
        : "Aún no se ha subido el video.";
      document.getElementById("auth-popup").style.display = "none";
      document.getElementById("user-content").style.display = "block";
    });
  }

  function saveProfile(e) {
    e.preventDefault();
    const user = auth.currentUser;
    if (!user) return;

    const ref = db.collection("users").doc(user.uid);
    ref.update({
      nombre: document.getElementById("nombre").value,
      apellido: document.getElementById("apellido").value,
      telefono: document.getElementById("telefono").value
    }).then(() => alert("Perfil actualizado"));
  }

  auth.onAuthStateChanged(user => {
    if (user) loadUserData(user);
  });
</script>

</body>
</html>
